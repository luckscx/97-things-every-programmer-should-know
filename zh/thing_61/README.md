# 单一二进制文件

我见过几个项目，在构建过程中会重写代码的某些部分，以便为每个目标环境生成定制的二进制文件。这总是让事情变得比应有的更复杂，并引入了团队在每个安装环境中可能没有一致版本的风险。至少，它涉及构建多个几乎相同的软件副本，每个副本都必须部署到正确的位置。这意味着比必要更多的移动部件，也就意味着更多的出错机会。

我曾经在一个团队工作，每次属性更改都必须经过完整的构建周期，因此每当测试人员需要进行小的调整时，他们就得等待（我有没有提到构建时间太长？）。我也曾在一个团队工作，系统管理员坚持在生产环境中从头开始重建（使用与我们相同的脚本），这意味着我们无法证明生产环境中的版本是经过测试的版本。诸如此类。

规则很简单：*构建一个单一的二进制文件，你可以在发布管道的所有阶段中识别和推广它。* 将环境特定的细节保留在环境中。这可能意味着将它们保存在组件容器中、已知文件中或路径中。

如果你的团队有一个代码混淆的构建过程，或者将所有目标设置与代码一起存储，这表明没有人足够仔细地思考设计，以区分应用程序的核心功能和特定于平台的功能。或者更糟：团队知道该怎么做，但无法优先考虑进行更改的工作。

当然，也有例外：你可能正在为资源约束显著不同的目标构建，但这并不适用于我们大多数编写“从数据库到屏幕再返回”应用程序的人。或者，你可能正在处理一些遗留的混乱问题，这些问题目前太难修复。在这种情况下，你必须逐步推进——但要尽快开始。

还有一件事：也要对环境信息进行版本控制。没有什么比破坏环境配置却无法弄清楚发生了什么变化更糟糕的了。环境信息应该与代码分开进行版本控制，因为它们会以不同的速度和不同的原因发生变化。一些团队为此使用分布式版本控制系统（如bazaar和git），因为它们使得在生产环境中进行的更改——这是不可避免的——更容易推送到仓库中。

作者：[Steve Freeman](http://programmer.97things.oreilly.com/wiki/index.php/Steve_Freeman)