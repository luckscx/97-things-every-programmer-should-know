# 重构之前

每个程序员在某个时刻都需要重构现有的代码。但在你开始之前，请考虑以下几点，这可能会为你和其他人节省大量时间（和痛苦）：

- **重构的最佳方法是从评估现有代码库及其对应的测试开始。** 这将帮助你理解当前代码的优势和劣势，从而确保你保留优点并避免错误。我们都认为自己可以比现有系统做得更好……直到我们最终得到的东西并不比之前的版本更好——甚至更糟——因为我们没有从现有系统的错误中吸取教训。

- **避免重写一切的诱惑。** 最好尽可能多地重用现有代码。无论代码多么丑陋，它已经经过了测试、审查等。抛弃旧代码——尤其是如果它已经在生产环境中运行——意味着你抛弃了数月（或数年）经过测试、经过实战考验的代码，这些代码可能包含了你不知道的某些变通方法和错误修复。如果你不考虑这一点，你编写的新代码可能会再次出现旧代码中已经修复的神秘错误。这将浪费大量时间、精力和多年来积累的知识。

- **多次小规模修改比一次大规模修改更好。** 小规模修改允许你通过反馈（例如测试）更容易地评估对系统的影响。在做出更改后看到一百个测试失败并不有趣。这可能会导致沮丧和压力，进而导致糟糕的决策。几个测试失败很容易处理，并提供了一种更可控的方法。

- **在每次迭代之后，确保现有测试通过非常重要。** 如果现有测试不足以覆盖你所做的更改，请添加新的测试。不要轻易抛弃旧代码的测试。表面上，其中一些测试可能看起来不适用于你的新设计，但深入挖掘这些测试添加的原因是非常值得的。

- **个人偏好和自尊心不应成为障碍。** 如果某些东西没有坏，为什么要修复它？代码的风格或结构不符合你的个人偏好并不是重构的有效理由。认为你可以比之前的程序员做得更好也不是一个有效的理由。

- **新技术不足以成为重构的理由。** 重构的最糟糕理由之一是当前代码远远落后于我们今天拥有的所有酷炫技术，并且我们相信新的语言或框架可以更优雅地完成工作。除非成本效益分析表明新语言或框架将显著改善功能、可维护性或生产力，否则最好保持现状。

- **记住人类会犯错误。** 重构并不总是保证新代码会比之前的尝试更好——甚至一样好。我见过并参与过几次失败的重构尝试。这并不美好，但这是人之常情。

作者：[Rajith Attapattu](http://programmer.97things.oreilly.com/wiki/index.php/Rajith_Attapattu)