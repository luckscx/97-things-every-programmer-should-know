#在重构之前

在某种程度上，每个程序员都需要重构现有代码。但在这样做之前，请考虑以下几点，因为这可以为您和其他人节省大量时间(和痛苦)：

-*重构的最佳方法是评估现有的代码库和针对该代码编写的测试。*这将帮助您了解当前代码的优点和缺点，因此您可以确保在保留优点的同时避免错误。我们都认为我们可以比现有的系统做得更好。直到我们最终得到的东西并不比上一次更好--甚至更糟--因为我们没有从现有系统的错误中吸取教训。

-*避免重写所有代码的诱惑。*最好是尽可能多地重复使用代码。不管代码有多难看，它已经经过了测试、审查等。丢弃旧代码--特别是如果它已经投入生产--意味着您丢弃了数月(或数年)经过测试、久经沙场的代码，这些代码可能已经有了您不知道的某些变通和错误修复。如果不考虑这一点，您编写的新代码可能会显示出与旧代码中修复的相同的神秘错误。这将浪费大量的时间、精力和多年积累的知识。

-*多个增量更改胜过一个大规模更改。*增量更改让您可以更轻松地通过反馈(例如来自测试的反馈)来衡量对系统的影响。在您进行更改之后，看到100个测试失败，这并不有趣。这会导致挫折感和压力，进而导致糟糕的决定。几个测试失败很容易处理，并提供了一种更易于管理的方法。

-*每次迭代后，务必确保现有测试通过。*如果现有测试不足以覆盖您所做的更改，请添加新测试。不要在未经考虑的情况下丢弃旧代码中的测试。从表面上看，这些测试中的一些似乎不适用于您的新设计，但深入挖掘添加此特定测试的原因将是非常值得的。

-*个人喜好和自负不应该成为障碍。*如果有些东西没有坏，为什么要修复它？代码的样式或结构不符合您的个人喜好，这不是重组的正当理由。认为你可以比以前的程序员做得更好也不是一个合理的理由。

-*新技术不足以重构。*重构最糟糕的原因之一是因为当前的代码远远落后于我们今天拥有的所有酷技术，我们相信新的语言或框架可以做得更优雅。除非成本效益分析表明，新的语言或框架将在功能、可维护性或生产力方面带来显著改进，否则最好保持原样。

-*记住人类会犯错。*重组并不总是能保证新的代码会更好，甚至不会像之前的尝试那样好。我亲眼目睹了几次失败的重组尝试，也参与了其中。它并不漂亮，但它是人类的。

作者：Rajith Attapattu](http://programmer.97things.oreilly.com/wiki/index.php/Rajith_Attapattu)