# 便利性不是一种“能力”

关于设计良好API的重要性和挑战，已经有很多讨论。第一次就设计正确是很困难的，之后要改变则更加困难。这有点像抚养孩子。大多数有经验的程序员都明白，一个好的API应该遵循一致的抽象层次，展现出一致性和对称性，并形成一个富有表现力的语言的词汇表。然而，了解指导原则并不自动转化为适当的行为。吃甜食对你有害。

与其高高在上地说教，我想针对一个特定的API设计“策略”进行批评，这是我一次又一次遇到的：便利性的论点。它通常始于以下“洞察”之一：

- 我不希望其他类必须进行两次单独的调用来完成这一件事。
- 如果这个方法几乎和另一个方法一样，为什么我还要再写一个方法呢？我只需要加一个简单的开关。
- 看，这很简单：如果第二个字符串参数以“.txt”结尾，方法会自动假设第一个参数是文件名，所以我真的不需要两个方法。

尽管初衷良好，这样的论点往往会降低使用API的代码的可读性。像这样的方法调用：

```
parser.processNodes(text, false);
```

如果不了解实现或至少查阅文档，几乎是没有意义的。这种方法可能是为了方便实现者而设计的，而不是为了方便调用者——“我不希望调用者必须进行两次单独的调用”转化为“我不想编写两个单独的方法”。如果便利性是为了解决繁琐、笨拙或尴尬的问题，那么它本身并没有根本性的错误。然而，如果我们更仔细地思考一下，解决这些症状的方法是效率、一致性和优雅性，而不一定是便利性。API应该隐藏底层的复杂性，因此我们可以合理地期望良好的API设计需要一些努力。一个单一的大型方法肯定比一组经过深思熟虑的操作更方便编写，但它会更容易使用吗？

将API比作语言的隐喻可以引导我们在这些情况下做出更好的设计决策。API应该提供一种富有表现力的语言，为上层的调用者提供足够的词汇来提出和回答有用的问题。这并不意味着它应该为每个可能值得提出的问题提供一个方法或动词。丰富的词汇表使我们能够表达意义的细微差别。例如，我们更喜欢说“跑”而不是“走（true）”，尽管它可以被视为本质上相同的操作，只是以不同的速度执行。一个一致且经过深思熟虑的API词汇表可以使上层的代码更具表现力且易于理解。更重要的是，一个可组合的词汇表允许其他程序员以你可能没有预料到的方式使用API——这对API的用户来说确实是一个巨大的便利！下次你忍不住想把几件事合并到一个API方法中时，请记住，英语中没有`MakeUpYourRoomBeQuietAndDoYourHomeWork`这样的单词，尽管对于这样一个经常被请求的操作来说，它似乎非常方便。

作者：[Gregor Hohpe](http://programmer.97things.oreilly.com/wiki/index.php/Gregor_Hohpe)