# 了解你的极限

> *“人必须知道自己的极限。” — 肮脏的哈里*

你的资源是有限的。你只有有限的时间和金钱来完成你的工作，包括保持你的知识、技能和工具最新所需的时间和金钱。你只能工作得如此努力、如此快速、如此聪明、如此长久。你的工具只有如此强大。你的目标机器只有如此强大。因此，你必须尊重你的资源极限。

如何尊重这些极限？了解你自己，了解你的团队，了解你的预算，了解你的工具。特别是，作为一名软件工程师，了解你的数据结构和算法的空间和时间复杂度，以及系统的架构和性能特征。你的工作是创建软件和系统的最佳结合。

空间和时间复杂度以函数 *O(f(n))* 表示，其中 n 等于输入的大小，表示随着 n 增长到无穷大时所需的渐近空间或时间。*f(n)* 的重要复杂度类别包括 *ln(n)*、*n*、*n ln(n)*、*n<sup>e</sup>* 和 *e<sup>n</sup>*。正如绘制这些函数所清楚显示的，随着 *n* 变大，*O(ln(n))* 远远小于 *O(n)* 和 *O(n ln(n))*，而后者又远远小于 *O(n<sup>e</sup>)* 和 *O(e<sup>n</sup>)*。正如 Sean Parent 所说，对于可实现的 n，所有复杂度类别都接近于常数、线性或无限。

![](http://programmer.97things.oreilly.com/wiki/images/c/c0/Clearly.jpeg)

|              | 访问时间      |   容量 |
|--------------|-----------------:| ----------:|
| 寄存器       |  < 1 ns          |        64b |
| 缓存行       |                  |        64B |
| L1 缓存      |  1 ns            | 64 KB      |
| L2 缓存      |  4 ns            | 8 MB       |
| 内存         | 20 ns            | 32 GB      |
| 磁盘         | 10 ms            | 10 TB      |
| 局域网       | 20 ms            | > 1 PB     |
| 互联网       | 100 ms           | > 1 ZB     |

复杂度分析是基于抽象机器的，但软件运行在真实机器上。现代计算机系统组织为物理和虚拟机器的层次结构，包括语言运行时、操作系统、CPU、缓存、随机存取内存、磁盘驱动器和网络。第一个表格展示了一个典型网络服务器的随机访问时间和存储容量的限制。

注意，容量和速度相差几个数量级。缓存和预取在我们的系统的每一层都被大量使用，以隐藏这种差异，但它们只有在访问可预测时才有效。当缓存未命中频繁时，系统将会颠簸。例如，随机检查硬盘上的每个字节可能需要 32 年。即使随机检查内存中的每个字节也可能需要 11 分钟。随机访问是不可预测的。什么是可预测的？这取决于系统，但重新访问最近使用的项目和顺序访问项目通常是有效的。

算法和数据结构在使用缓存方面的效率各不相同。例如：
- 线性搜索充分利用了预取，但需要 *O(n)* 次比较。
- 对排序数组的二分搜索只需要 *O(log(n))* 次比较。
- van Emde Boas 树的搜索是 *O(log(n))* 并且是缓存无关的。

|元素数量 | 搜索时间 (ns)|       |         |
|:--------|-----------:|-----------:|--------:|
|         | **线性** | **二分** |	**vEB** |
| 8       | 50         | 90         | 40      |
| 64      | 180        | 150        | 70      |
| 512     | 1200       | 230        | 100     |
| 4096    | 17000      | 320        | 160     |

如何选择？最终，通过测量。第二个表格展示了通过这三种方法搜索 64 位整数数组所需的时间。在我的电脑上：
- 线性搜索在小数组上具有竞争力，但在大数组上呈指数级下降。
- van Emde Boas 由于其可预测的访问模式而轻松胜出。

> *“你付钱，你选择。” — [Punch](http://www.nytimes.com/1988/02/28/magazine/on-language-you-pays-yer-money.html?pagewanted=all)*

作者：[Greg Colvin](http://programmer.97things.oreilly.com/wiki/index.php/Greg_Colvin)