# 为人编写测试

你正在为部分或全部的生产代码编写自动化测试。恭喜你！你是在编写代码之前编写测试吗？那就更好了！仅仅做到这一点，你就已经站在了软件工程实践的前沿，成为早期采用者之一。但是，你编写的测试是好测试吗？如何判断呢？一种方法是问自己：“我为谁编写这些测试？”如果答案是“为我自己，为了省去修复bug的麻烦”或“为编译器，以便它们可以执行”，那么很可能你并没有编写出最好的测试。那么，你应该为谁编写测试呢？**为那些试图理解你代码的人**。

好的测试就像是代码的文档。它们描述了代码的工作原理。对于每个使用场景，测试应该：

1. 描述上下文、起点或必须满足的前提条件
2. 展示软件是如何被调用的
3. 描述预期的结果或需要验证的后置条件

不同的使用场景在这些方面会有略微不同的版本。试图理解你代码的人应该能够通过查看几个测试，并比较这些测试的这三个部分，来了解是什么导致软件行为的不同。每个测试都应该清晰地展示这三个部分之间的因果关系。这意味着测试中不可见的部分与可见的部分同样重要。测试中过多的代码会让读者分心，关注不重要的细节。尽可能将这些细节隐藏在有意义的方法调用背后——**提取方法**重构是你最好的朋友。确保为每个测试起一个有意义的名称，描述特定的使用场景，这样测试的读者就不必通过逆向工程来理解各种场景。测试类和类方法的名称之间至少应该包括起点和软件的调用方式。这样可以通过快速扫描方法名称来验证测试覆盖率。如果不会导致名称过长，也可以在测试方法名称中包含预期结果。

测试你的测试也是一个好主意。你可以通过将错误插入生产代码（当然是你自己的私有副本，之后会丢弃）来验证它们是否能检测到你认为它们能检测到的错误。确保它们以有帮助且有意义的方式报告错误。你还应该验证你的测试是否清晰地传达给试图理解你代码的人。唯一的方法是让不熟悉你代码的人阅读你的测试，并告诉你他们学到了什么。仔细倾听他们的话。如果他们不清楚某些内容，很可能不是因为他们不够聪明，而是因为你表达得不够清晰。（你也可以反过来阅读他们的测试！）

作者：[Gerard Meszaros](http://programmer.97things.oreilly.com/wiki/index.php/Gerard_Meszaros)