# 不要将你的程序钉在直立的位置

我曾经写过一个恶搞的C++测验，其中我讽刺地提出了以下异常处理策略：

> 通过在代码库中大量使用`try...catch`结构，我们有时能够防止应用程序中止。我们将这种结果状态称为“将尸体钉在直立的位置”。

尽管我是在开玩笑，但实际上我是在总结我从“痛苦经验女士”那里学到的一课。

这是我们自制的C++库中的一个基础应用程序类。多年来，它被许多程序员的手指戳过：没有人的手是干净的。它包含了处理所有其他代码逃逸异常的代码。受到《第二十二条军规》中尤索林的启发，我们决定，或者更确切地说是感觉（“决定”这个词暗示了比构建这个怪物时更多的思考），这个类的一个实例应该永远存在，或者在尝试中死去。

为此，我们交织了多个异常处理程序。我们将Windows的结构化异常处理与本机异常处理混合在一起（还记得C++中的`__try...__except`吗？我也不记得了）。当事情意外抛出异常时，我们尝试再次调用它们，更用力地按下参数。回想起来，我喜欢认为当我在另一个`catch`子句中编写内部的`try...catch`处理程序时，某种意识悄然袭来，我可能无意中从良好实践的高速公路上拐入了疯狂但诱人的小巷。然而，这可能是事后的智慧。

不用说，每当基于这个类的应用程序出现问题时，它们就像码头边的黑手党受害者一样消失，没有留下任何有用的气泡痕迹来指示到底发生了什么，尽管据说调用了转储例程来记录灾难。最终——经过漫长的等待——我们评估了我们所做的事情，并感到了羞耻。我们用最小且健壮的报告机制替换了整个混乱。但这已经是在许多崩溃之后了。

我不会用这个来打扰你——因为肯定没有人会像我们一样愚蠢——但因为我最近与一个学术头衔表明他应该更懂的人进行了一场在线争论。我们正在讨论远程事务中的Java代码。他认为，如果代码失败，它应该就地捕获并阻止异常。（“然后用它做什么？”我问。“做晚饭吗？”）

他引用了UI设计者的规则：永远不要让用户看到异常报告，仿佛这就能解决问题，毕竟它是大写的。我想知道他是否负责那些蓝屏ATM机的代码，这些ATM机的照片装饰了那些较弱的博客，并且他因此受到了永久的精神创伤。无论如何，如果你遇到他，点头微笑，不要理会，然后悄悄走向门口。

作者：[Verity Stob](http://programmer.97things.oreilly.com/wiki/index.php/Verity_Stob)