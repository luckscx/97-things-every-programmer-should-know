# 使用正确的算法和数据结构

> 一家拥有许多分支机构的大银行抱怨说，它为新柜员购买的计算机速度太慢。这是在电子银行普及之前，自动取款机（ATM）还没有像现在这样普遍的时代。人们会频繁地访问银行，而缓慢的计算机使得人们排起了长队。因此，银行威胁要终止与供应商的合同。

> 供应商派了一名性能分析和调优专家来确定延迟的原因。他很快发现一个特定的程序在终端上运行，几乎消耗了所有的CPU资源。使用分析工具，他深入研究了该程序，并找到了罪魁祸首的函数。源代码是这样的：

> ```
> for (i=0; i<strlen(s); ++i) {
>   if (... s[i] ...) ...
> }
> ```

> 而字符串`s`平均有数千个字符长。这段代码（由银行编写）很快被修改，银行柜员从此过上了幸福的生活……

难道程序员不应该做得更好，避免使用这种不必要地具有二次方复杂度的代码吗？
每次调用`strlen`都会遍历字符串中的数千个字符以找到其终止的空字符。然而，字符串从未改变。通过在循环之前确定字符串的长度，程序员可以节省数千次`strlen`调用（以及数百万次循环执行）：

```
n=strlen(s);
for (i=0; i<n; ++i) {
  if (... s[i] ...) ...
}
```

大家都知道这句格言：“先让它工作，然后再让它更快”，以避免陷入微观优化的陷阱。但上面的例子几乎让你相信程序员遵循了马基雅维利的格言：“先让它慢点工作。”

这种不加思考的情况你可能会不止一次遇到。这不仅仅是“不要重新发明轮子”的问题。有时新手程序员只是开始敲代码而没有真正思考，突然之间他们就“发明”了冒泡排序。他们甚至可能还会为此沾沾自喜。

选择正确算法的另一面是选择合适的数据结构。它可能会产生巨大的影响：对于一个包含百万个项目的集合，使用链表进行搜索——与使用哈希数据结构或二叉树相比——将极大地影响用户对你编程的评价。

程序员不应该重新发明轮子，应该尽可能使用现有的库。但为了避免像银行那样的错误，他们还应该接受关于算法及其复杂度的教育。现代文本编辑器中的那些花哨功能是否使它们像20世纪80年代的WordStar一样慢？许多人说编程中的重用至关重要。然而，最重要的是，程序员应该知道何时、什么以及如何重用。要做到这一点，他们应该具备问题领域的知识以及算法和数据结构的了解。

一个好的程序员还应该知道何时使用一个看似糟糕的算法。例如，如果问题领域规定项目数量永远不会超过五个（比如Yathzee游戏中的骰子数量），你就知道你*总是*最多只需要对五个项目进行排序。在这种情况下，冒泡排序实际上可能是最有效的排序方式。每个人都有得意的时候。

所以，读一些好书——并确保你理解它们。如果你真的读懂了高德纳（Donald Knuth）的《计算机程序设计艺术》，你甚至可能会很幸运：找到作者的一个错误，并赢得高德纳的十六进制美元支票（2.56美元）。

作者：[JC van Winkel](http://programmer.97things.oreilly.com/wiki/index.php/JC_van_Winkel)