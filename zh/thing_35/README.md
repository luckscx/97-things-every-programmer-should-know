#API设计黄金法则

API的设计很困难，尤其是在大型应用中。如果您正在设计一个将拥有数百或数千用户的API，您必须考虑将来可能如何更改它，以及您的更改是否会破坏客户端代码。除此之外，您还必须考虑API的用户对您的影响。如果您的某个API类在内部使用它自己的方法之一，您必须记住，用户可以子类化您的类并覆盖它，这可能是灾难性的。您无法更改该方法，因为您的一些用户已经赋予了它不同的含义。您未来的内部实施选择取决于您的用户。

API开发人员通过各种方式解决这个问题，但最简单的方法是锁定API。如果您使用的是Java，那么您可能会忍不住将大多数类和方法设置为FINAL。在C#中，您可以密封您的类和方法。无论您使用的是哪种语言，您都可能会尝试通过单例或使用静态工厂方法来呈现您的API，这样您就可以防止有人重写行为并以限制您以后的选择的方式使用您的代码。这一切看起来都很合理，但真的是这样吗？

在过去的十年中，我们逐渐意识到单元测试是实践中极其重要的一部分，但这一教训并没有完全渗透到整个行业。证据就在我们身边。取一个使用第三方API的未经测试的任意类，并尝试为其编写单元测试。大多数情况下，你会遇到麻烦。您会发现使用该API的代码就像胶水一样粘在上面。没有办法模拟API类，以便您可以感知代码与它们的交互，或者为测试提供返回值。

随着时间的推移，这将变得更好，但前提是我们在设计API时开始将测试视为真正的用例。不幸的是，这比仅仅测试我们的代码要复杂一些。这就是**API设计黄金法则**适用的地方：*仅为您开发的API编写测试是不够的；您必须为使用您的API的代码编写单元测试。当您这样做时，您将直接了解用户在尝试独立测试其代码时必须克服的障碍。*

没有一种方法可以让开发人员轻松地测试使用您的API的代码。`static`、`final`和`sealed`本身并不是糟糕的构造。它们有时会很有用。但重要的是要意识到测试问题，要做到这一点，你必须亲自体验。一旦你做到了，你就可以像处理任何其他设计挑战一样处理它。

作者：[Michael Feathers](http://programmer.97things.oreilly.com/wiki/index.php/Michael_Feathers)