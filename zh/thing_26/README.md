#不要忽视这个错误！

一天晚上，我走在街上，在一家酒吧里见了几个朋友。我们已经有一段时间没有共享啤酒了，我期待着再次见到他们。在匆忙中，我没有看清我要去的地方。我被路边绊倒，最后摔倒在地。我想，我没有注意到这是罪有应得。

我的腿疼，但我正赶着去见我的朋友。所以我振作起来，继续前进。当我走得更远时，疼痛加剧了。尽管一开始我对此不屑一顾，但我很快意识到有些不对劲。

但我还是不顾一切地赶到了吧台。当我到达时，我正处于痛苦之中。我在外面度过了一个不愉快的夜晚，因为我太分心了。早上我去看医生，发现我的胫骨骨折了。如果我在感觉到疼痛的时候停下来，我就可以避免因踩在上面行走而造成的许多额外伤害。可能是我一生中最糟糕的早晨*

太多的程序员编写了像我这样灾难性的夜晚外出的代码。

*错误，什么错误？不会很严重的。老实说。我可以忽略它。*对于可靠的代码来说，这不是一个制胜策略。事实上，这就是纯粹的懒惰。(错误的类型。)无论您认为代码中出现错误的可能性有多大，都应该始终检查并始终处理它。每次都是。如果你不这样做，你就不是在节省时间：你在为未来积累潜在的问题。

我们以多种方式报告代码中的错误，包括：

-**返回码**可以作为函数的结果值，表示“不起作用”。错误返回代码太容易忽略了。您不会在代码中看到任何突出显示该问题的内容。事实上，忽略一些标准C函数的返回值已经成为一种标准做法。您多久检查一次来自printf的返回值？

-**errno**是一种奇怪的C异常，是设置为表示错误的单独全局变量。它很容易被忽略，很难使用，并导致各种令人讨厌的问题-例如，当您有多个线程调用相同的函数时会发生什么？在这里，一些平台可以让你远离痛苦，而其他平台则不能。

-**异常**是一种更结构化的语言支持的错误信号和处理方式。你不可能忽视他们。或者你能做到吗？我见过很多这样的代码：

```
试试看{
//……做点什么……
}
Catch(...){}//忽略错误
```

这种糟糕的结构的可取之处在于，它突出了一个事实，即你正在做的事情在道德上是可疑的。

如果你忽视一个错误，睁一只眼闭一只眼，假装什么都没有错，你就冒了很大的风险。就像我的腿最终比我立即停止行走时的状态更糟糕一样，不顾一切地继续前进会导致非常复杂的失败。尽早处理问题。做一个简短的记账。

不处理错误会导致：

-**脆弱的代码。**充满令人兴奋的、难以找到的错误的代码。
-**代码不安全。**黑客经常利用错误处理不力来侵入软件系统。
-**结构差。**如果您的代码中有持续处理的繁琐错误，那么您的接口可能很差。表达它，这样错误就不那么侵扰，它们的处理也不那么繁琐。

正如您应该检查代码中的所有潜在错误一样，您需要公开接口中的所有潜在错误条件。不要隐藏它们，假装你的服务总是有效的。

我们为什么不检查一下错误呢？有很多常见的借口。你同意这些中的哪一个？你会如何应对每一种情况？

-错误处理会扰乱代码流，使其更难阅读，也更难发现“正常”的执行流。
-这是额外的工作，而且我的最后期限迫在眉睫。
-我知道这个函数调用永远不会返回错误(printf总是有效的，Malloc总是返回新的内存-如果失败了，我们就会有更大的问题...)。
-这只是一个玩具程序，不需要写到值得制作的水平。

作者：Pete Goodliffe](http://programmer.97things.oreilly.com/wiki/index.php/Pete_Goodliffe)
